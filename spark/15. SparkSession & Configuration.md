# 15. SparkSession & Configuration ⚙️

## SparkSession: Entry Point

```python
from pyspark.sql import SparkSession

# Basic session
spark = SparkSession.builder \
    .appName("MyApp") \
    .getOrCreate()

# With configurations
spark = SparkSession.builder \
    .appName("MyApp") \
    .master("local[4]") \
    .config("spark.executor.memory", "4g") \
    .config("spark.sql.shuffle.partitions", "200") \
    .getOrCreate()

# Master options:
# - "local": Single-threaded
# - "local[4]": 4 local threads
# - "local[*]": Use all available cores
# - "yarn": YARN cluster manager
# - "k8s://...": Kubernetes
```

## Critical Configurations

```python
spark = SparkSession.builder \
    .appName("MyApp") \
    .config("spark.executor.memory", "8g") \
    .config("spark.executor.cores", "4") \
    .config("spark.executor.instances", "20") \
    .config("spark.driver.memory", "2g") \
    .config("spark.sql.shuffle.partitions", "500") \
    .config("spark.sql.adaptive.enabled", "true") \
    .config("spark.sql.adaptive.coalescePartitions.enabled", "true") \
    .config("spark.memory.fraction", "0.75") \
    .config("spark.memory.storageFraction", "0.5") \
    .config("spark.default.parallelism", "100") \
    .config("spark.sql.broadcastJoinThreshold", "10485760") \
    .config("spark.sql.autoBroadcastJoinThreshold", "10485760") \
    .getOrCreate()
```

| Config                         | Default | Impact                      |
| ------------------------------ | ------- | --------------------------- |
| `spark.executor.memory`        | 1g      | Heap memory per executor    |
| `spark.executor.cores`         | 1       | CPU cores per executor      |
| `spark.executor.instances`     | varies  | Number of executors         |
| `spark.driver.memory`          | 1g      | Heap memory for driver      |
| `spark.sql.shuffle.partitions` | 200     | Partitions after shuffle    |
| `spark.sql.adaptive.enabled`   | false   | Adaptive query optimization |
| `spark.memory.fraction`        | 0.6     | % of heap for Spark         |
| `spark.memory.storageFraction` | 0.5     | Storage vs execution memory |
